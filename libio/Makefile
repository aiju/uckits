TARGET=stm32
CPUS=\
	STM32F030x6 \
	STM32F030x8 \
	STM32F031x6 \
	STM32F038xx \
	STM32F042x6 \
	STM32F048xx \
	STM32F051x8 \
	STM32F058xx \
	STM32F070x6 \
	STM32F070xB \
	STM32F071xB \
	STM32F072xB \
	STM32F078xx \
	STM32F091xC \
	STM32F098xx \
	STM32F030xC \
	STM32F100xB \
	STM32F100xE \
	STM32F101x6 \
	STM32F101xB \
	STM32F101xE \
	STM32F101xG \
	STM32F102x6 \
	STM32F102xB \
	STM32F103x6 \
	STM32F103xB \
	STM32F103xE \
	STM32F103xG \
	STM32F105xC \
	STM32F107xC \
	STM32F205xx \
	STM32F215xx \
	STM32F207xx \
	STM32F217xx \
	STM32F301x8 \
	STM32F302x8 \
	STM32F302xC \
	STM32F302xE \
	STM32F303x8 \
	STM32F303xC \
	STM32F303xE \
	STM32F373xC \
	STM32F334x8 \
	STM32F318xx \
	STM32F328xx \
	STM32F358xx \
	STM32F378xx \
	STM32F398xx \
	STM32F405xx \
	STM32F415xx \
	STM32F407xx \
	STM32F417xx \
	STM32F427xx \
	STM32F437xx \
	STM32F429xx \
	STM32F439xx \
	STM32F401xC \
	STM32F401xE \
	STM32F410Tx \
	STM32F410Cx \
	STM32F410Rx \
	STM32F411xE \
	STM32F446xx \
	STM32F469xx \
	STM32F479xx \
	STM32F412Cx \
	STM32F412Zx \
	STM32F412Rx \
	STM32F412Vx \
	STM32F413xx \
	STM32F423xx \
	STM32F722xx \
	STM32F723xx \
	STM32F732xx \
	STM32F733xx \
	STM32F756xx \
	STM32F746xx \
	STM32F745xx \
	STM32F765xx \
	STM32F767xx \
	STM32F769xx \
	STM32F777xx \
	STM32F779xx \
	STM32H743xx \
	STM32H753xx \
	STM32L011xx \
	STM32L021xx \
	STM32L031xx \
	STM32L041xx \
	STM32L051xx \
	STM32L052xx \
	STM32L053xx \
	STM32L062xx \
	STM32L063xx \
	STM32L061xx \
	STM32L071xx \
	STM32L072xx \
	STM32L073xx \
	STM32L082xx \
	STM32L083xx \
	STM32L081xx \
	STM32L100xB \
	STM32L100xBA \
	STM32L100xC \
	STM32L151xB \
	STM32L151xBA \
	STM32L151xC \
	STM32L151xCA \
	STM32L151xD \
	STM32L151xDX \
	STM32L151xE \
	STM32L152xB \
	STM32L152xBA \
	STM32L152xC \
	STM32L152xCA \
	STM32L152xD \
	STM32L152xDX \
	STM32L152xE \
	STM32L162xC \
	STM32L162xCA \
	STM32L162xD \
	STM32L162xDX \
	STM32L162xE \
	STM32L431xx \
	STM32L432xx \
	STM32L433xx \
	STM32L442xx \
	STM32L443xx \
	STM32L451xx \
	STM32L452xx \
	STM32L462xx \
	STM32L471xx \
	STM32L475xx \
	STM32L476xx \
	STM32L485xx \
	STM32L486xx \
	STM32L496xx \
	STM32L4A6xx

include ../Makefile.pre

OFILESPAT:=$(patsubst $(TARGET)/%.c,$(TARGET)/%.%.o,$(wildcard $(TARGET)/*.c)) $(TARGET)/peri.%.o
OFILES:=$(foreach CPU,$(CPUS),$(patsubst %.%.o,%.$(CPU).o,$(OFILESPAT)))

LIBS:=$(foreach CPU,$(CPUS),$(UCKITS)/$(TARGET)/lib/libio.$(CPU).a)

.SECONDARY: $(OFILES)

.PHONY: all

all: $(LIBS)

$(UCKITS)/$(TARGET)/lib/libio.%.a: $(OFILESPAT)
	ar cr $@ $(OFILESPAT:%.%.o=%.$*.o)

$(foreach CPU,$(CPUS),$(eval $(TARGET)/%.$(CPU).o: $(TARGET)/%.c; $(CC) -c $(CFLAGS) $$< -o $$@))
$(foreach CPU,$(CPUS),$(eval $(TARGET)/%.$(CPU).o: $(TARGET)/%.$(CPU).c; $(CC) -c $(CFLAGS) $$< -o $$@))

$(TARGET)/peri.%.c: $(TARGET)/perigen.sh
	$(TARGET)/perigen.sh $* > $@

.PHONY: clean
clean:
	$(RM) $(OFILES)

.PHONY: nuke
nuke: clean
	$(RM) $(LIBS)
